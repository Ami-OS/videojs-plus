!function(e){"use strict";function t(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var i=e.getComponent("Button"),n=function(e){function i(t,i){var n;return n=e.call(this,t,i)||this,n.el_.querySelector(".vjs-icon-placeholder").className+=" vjs-icon-picture-in-picture",n}t(i,e);var n=i.prototype;return n.buildCSSClass=function(){return"vjs-pip-button "+e.prototype.buildCSSClass.call(this)},n.handleClick=function(){for(var t,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];(t=e.prototype.handleClick).call.apply(t,[this].concat(n)),this.player_.pictureInPicture().toggle()},i}(i);n.prototype.controlText_="Picture in Picture",e.registerComponent("PipButton",n),e.hook("setup",function(e){var t=e.findChild("SettingMenuButton")[0],i=t.parent,o=t.index;i.addChild(new n(e),{},o)});var o=e.getComponent("Component"),r=function(e){function i(t,i){var n;return n=e.call(this,t,i)||this,n.el_.appendChild(t.el()),i.wrapper||(n.addClass("vjs-pip-player-wrapper"),document.body.appendChild(n.el_)),n}return t(i,e),i.prototype.createEl=function(){return this.options_.wrapper?this.options_.wrapper:e.prototype.createEl.call(this)},i}(o);e.registerComponent("PipPlayerWrapper",r);var a=e.getPlugin("plugin"),s=function(i){function n(e,t){var n;return void 0===t&&(t={}),n=i.call(this,e,t)||this,console.log("HI"),n.cache_={},n.pipPlayer=null,n.options_=t,n}t(n,i);var o=n.prototype;return o.toggle=function(){this.pipPlayer?this.dispose():this.init()},o.init=function(){this.pipPlayer||(this.handleOriginPlayer(),this.createPipPlayer())},o.createPipPlayer=function(){var t=this.player,i=this.options_,n=t.id_+"-pip-player",o=e.dom.createEl("video",{id:n,className:"vjs-pip-player"});document.body.appendChild(o);var a=Object.assign(t.options_,{autoplay:!0,muted:t.muted()}),s=this.pipPlayer=videojs(o,a);console.log(this.pipPlayer),this.wrapper=new r(s,i),this.dragzone=s.getChild("PlayToggleLayer"),this.updatePosition(Object.assign({},this.cache_,i)),s.ready(function(){s.currentTime(t.currentTime()),s.play()}),!1!==i.draggable&&this.draggable(this.dragzone.el_)},o.handleOriginPlayer=function(){var e=this,t=this.player;t.pause(),t.hasStarted(!1),t.controls(!1),t.addClass("vjs-pip-player-enabled"),t.one("play",function(){e.dispose(),e.wrapper.dispose()})},o.dispose=function(){var e=this.player,t=this.pipPlayer;t&&(e.controls(!0),e.removeClass("vjs-pip-player-enabled"),e.paused()&&e.play(),!t.ended()&&e.currentTime(t.currentTime()),t.dispose(),this.pipPlayer=null)},o.updatePosition=function(e){var t=e.x,i=e.y;void 0!==t&&void 0!==i&&(this.wrapper.el_.style.bottom=i+"px",this.wrapper.el_.style.left=t+"px")},o.draggable=function(e){var t,i,n=this,o=this,r=function(o){o.preventDefault(),n.cache_.x=Math.max(0,Math.min(window.innerWidth-e.offsetWidth,o.clientX-t)),n.cache_.y=Math.max(0,Math.min(window.innerHeight-e.offsetHeight,window.innerHeight-o.clientY-e.offsetHeight+i)),n.updatePosition(n.cache_)};e.addEventListener("mousedown",function(e){e.preventDefault(),t=e.offsetX,i=e.offsetY;var n=function e(){window.removeEventListener("mousemove",e),o.dragzone.disable()};window.addEventListener("mousemove",r),window.addEventListener("mousemove",n),window.addEventListener("mouseup",function e(t){window.removeEventListener("mouseup",e),window.removeEventListener("mousemove",r),window.removeEventListener("mousemove",n),setTimeout(function(){o.dragzone.enable()},0)})});var a=function(){var t=n.cache_,i=t.x,o=t.y;n.updatePosition({x:Math.min(i,window.innerWidth-e.offsetWidth),y:Math.min(o,window.innerHeight-e.offsetHeight)})};window.addEventListener("resize",a),this.pipPlayer.on("dispose",function(){window.removeEventListener("resize",a)})},n}(a);e.registerPlugin("pictureInPicture",s)}(videojs);
