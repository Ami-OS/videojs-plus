{"version":3,"file":"picture-in-picture.es.js","sources":["../../../source/Plugin/PictureInPicture/ExitPipButton.js","../../../source/Plugin/PictureInPicture/PipPlayerWrapper.js","../../../source/Plugin/PictureInPicture/PipButton.js","../../../source/Plugin/PictureInPicture/PictureInPicture.js"],"sourcesContent":["import videojs from 'video.js';\n\nconst ClickableComponent = videojs.getComponent('ClickableComponent');\n\nclass ExitPipButton extends ClickableComponent {\n  constructor(player, options) {\n    super(player, {\n      name: 'ExitPipButton',\n      ...options\n    });\n\n    this.addClass('vjs-exit-pip-button');\n\n    this.el_.querySelector('.vjs-icon-placeholder').innerHTML = '&#10005;';\n  }\n\n  handleClick() {\n    this.options_.parentPlayer.pictureInPicture().exit();\n  }\n}\n\nExitPipButton.prototype.controlText_ = 'Exit Pictutre In Pictutre';\n\nvideojs.registerComponent('ExitPipButton', ExitPipButton);\n\nexport default ExitPipButton;\n","import videojs from 'video.js';\nimport ExitPipButton from './ExitPipButton';\n\nconst Component = videojs.getComponent('Component');\n\nclass PipPlayerWrapper extends Component {\n  constructor(player, options) {\n    super(player, options);\n\n    player.addChild(\n      new ExitPipButton(player, {\n        parentPlayer: options.parentPlayer\n      })\n    );\n\n    this.addChild(player);\n\n    if (!options.wrapper) {\n      this.addClass('vjs-pip-player-wrapper');\n      document.body.appendChild(this.el_);\n    }\n  }\n\n  createEl() {\n    if (this.options_.wrapper) {\n      return this.options_.wrapper;\n    }\n\n    return super.createEl();\n  }\n}\n\nvideojs.registerComponent('PipPlayerWrapper', PipPlayerWrapper);\n\nexport default PipPlayerWrapper;\n","import videojs from 'video.js';\n\nconst Button = videojs.getComponent('Button');\n\nclass PipButton extends Button {\n  constructor(player, options) {\n    super(player, options);\n\n    this.el_.querySelector('.vjs-icon-placeholder').className += ' vjs-icon-picture-in-picture';\n  }\n\n  buildCSSClass() {\n    return `vjs-pip-button ${super.buildCSSClass()}`;\n  }\n\n  handleClick(...args) {\n    super.handleClick(...args);\n\n    this.player_.pictureInPicture().toggle();\n  }\n}\n\nPipButton.prototype.controlText_ = 'Picture in Picture';\n\nvideojs.registerComponent('PipButton', PipButton);\n\nvideojs.hook('setup', vjsPlayer => {\n  const { parent, index } = vjsPlayer.findChild('SettingMenuButton')[0];\n\n  parent.addChild(new PipButton(vjsPlayer), {}, index);\n});\n","import videojs from 'video.js';\n\nimport PipPlayerWrapper from './PipPlayerWrapper';\nimport './PictureInPicture.scss';\nimport './PipButton';\n\nclass pictureInPicture extends videojs.getPlugin('plugin') {\n  constructor(player, options = {}) {\n    super(player, options);\n\n    this.cache_ = {};\n    this.pipPlayer = null;\n    this.options_ = options;\n    this.parentPlayer = player;\n  }\n\n  toggle() {\n    if (this.pipPlayer) {\n      this.exit();\n    } else {\n      this.init();\n    }\n  }\n\n  init() {\n    if (!this.pipPlayer) {\n      this.handleOriginPlayer();\n      this.createPipPlayer();\n    }\n  }\n\n  createPipPlayer() {\n    const { parentPlayer, options_ } = this;\n    const id = parentPlayer.id_ + '-pip-player';\n    const videoEl = videojs.dom.createEl('video', {\n      id,\n      className: 'vjs-pip-player'\n    });\n\n    document.body.appendChild(videoEl);\n\n    const pipPlayerOptions = {\n      ...parentPlayer.options_,\n      ...parentPlayer.cache_,\n      autoplay: true,\n      muted: parentPlayer.muted()\n    };\n\n    const pipPlayer = (this.pipPlayer = videojs(videoEl, pipPlayerOptions));\n\n    this.wrapper = new PipPlayerWrapper(pipPlayer, {\n      ...options_,\n      parentPlayer\n    });\n\n    this.dragzone = pipPlayer.getChild('PlayToggleLayer');\n\n    this.updatePosition({\n      ...this.cache_,\n      ...options_\n    });\n\n    pipPlayer.ready(() => {\n      pipPlayer.currentTime(parentPlayer.currentTime());\n      pipPlayer.play();\n    });\n\n    if (options_.draggable !== false) {\n      this.draggable(this.dragzone.el_);\n    }\n  }\n\n  handleOriginPlayer() {\n    const { parentPlayer } = this;\n\n    parentPlayer.pause();\n    parentPlayer.hasStarted(false);\n    parentPlayer.controls(false);\n    parentPlayer.addClass('vjs-pip-player-enabled');\n\n    parentPlayer.one('play', () => {\n      this.exit();\n    });\n  }\n\n  exit() {\n    const { parentPlayer, pipPlayer, wrapper } = this;\n\n    if (parentPlayer) {\n      parentPlayer.controls(true);\n      parentPlayer.removeClass('vjs-pip-player-enabled');\n      parentPlayer.paused() && parentPlayer.play();\n\n      if (pipPlayer) {\n        if (!pipPlayer.ended()) {\n          parentPlayer.currentTime(pipPlayer.currentTime());\n        }\n      }\n    }\n\n    if (pipPlayer) {\n      pipPlayer.dispose();\n      wrapper.dispose();\n    }\n\n    this.pipPlayer = null;\n  }\n\n  dispose() {\n    this.parentPlayer = null;\n  }\n\n  updatePosition({ x, y }) {\n    if (typeof x !== 'undefined' && typeof y !== 'undefined') {\n      this.wrapper.el_.style.bottom = y + 'px';\n      this.wrapper.el_.style.left = x + 'px';\n    }\n  }\n\n  draggable(el) {\n    let x, y;\n    const _this = this;\n\n    const move = evt => {\n      evt.preventDefault();\n\n      this.cache_.x = Math.max(0, Math.min(window.innerWidth - el.offsetWidth, evt.clientX - x));\n      this.cache_.y = Math.max(\n        0,\n        Math.min(window.innerHeight - el.offsetHeight, window.innerHeight - evt.clientY - el.offsetHeight + y)\n      );\n\n      this.updatePosition(this.cache_);\n    };\n\n    el.addEventListener('mousedown', evt => {\n      evt.preventDefault();\n\n      x = evt.offsetX;\n      y = evt.offsetY;\n\n      const disableClick = () => {\n        window.removeEventListener('mousemove', disableClick);\n        _this.dragzone.disable();\n      };\n\n      window.addEventListener('mousemove', move);\n      window.addEventListener('mousemove', disableClick);\n\n      window.addEventListener('mouseup', function mouseup(evt) {\n        window.removeEventListener('mouseup', mouseup);\n        window.removeEventListener('mousemove', move);\n        window.removeEventListener('mousemove', disableClick);\n\n        setTimeout(() => {\n          _this.dragzone.enable();\n        }, 0);\n      });\n    });\n\n    const onResize = () => {\n      const { x, y } = this.cache_;\n\n      this.updatePosition({\n        x: Math.min(x, window.innerWidth - el.offsetWidth),\n        y: Math.min(y, window.innerHeight - el.offsetHeight)\n      });\n    };\n\n    window.addEventListener('resize', onResize);\n\n    this.pipPlayer.on('dispose', () => {\n      window.removeEventListener('resize', onResize);\n    });\n  }\n}\n\nvideojs.registerPlugin('pictureInPicture', pictureInPicture);\n"],"names":["ClickableComponent","videojs","getComponent","ExitPipButton","player","options","name","addClass","el_","querySelector","innerHTML","handleClick","options_","parentPlayer","pictureInPicture","exit","prototype","controlText_","registerComponent","Component","PipPlayerWrapper","addChild","wrapper","document","body","appendChild","createEl","Button","PipButton","className","buildCSSClass","args","player_","toggle","hook","vjsPlayer","findChild","parent","index","cache_","pipPlayer","init","handleOriginPlayer","createPipPlayer","id","id_","videoEl","dom","pipPlayerOptions","autoplay","muted","dragzone","getChild","updatePosition","ready","currentTime","play","draggable","pause","hasStarted","controls","one","removeClass","paused","ended","dispose","x","y","style","bottom","left","el","_this","move","evt","preventDefault","Math","max","min","window","innerWidth","offsetWidth","clientX","innerHeight","offsetHeight","clientY","addEventListener","offsetX","offsetY","disableClick","removeEventListener","disable","mouseup","setTimeout","enable","onResize","on","getPlugin","registerPlugin"],"mappings":"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"}