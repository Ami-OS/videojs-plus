{"version":3,"file":"index.js","sources":["../../../source/Plugin/AudioTrack/AudioTrackSettingItem.js","../../../source/Plugin/AudioTrack/AudioTrack.js"],"sourcesContent":["import videojs from 'video.js';\n\nconst SettingOptionItem = videojs.getComponent('SettingOptionItem');\n\nclass AudioTrackSettingItem extends SettingOptionItem {\n  constructor(player, options) {\n    super(player, {\n      ...options,\n      name: 'AudioTrackSettingItem',\n      label: 'Audio',\n      icon: 'vjs-icon-audiotrack'\n    });\n\n    this.addClass('vjs-setting-audio');\n\n    let timeout;\n    const onHlsUsageEvent = evt => {\n      if (evt.name === 'hls-audio-change') {\n        clearTimeout(timeout);\n\n        timeout = setTimeout(this.handleAudioChangeEvent.bind(this), 10);\n      } else if (evt.name === 'hls-alternate-audio') {\n        this.onAlternateAudio();\n      }\n    };\n\n    // show when alternate audio detected\n    player.tech_.on('usage', onHlsUsageEvent);\n\n    // unbind the callback on player dispose\n    player.on('dispose', () => {\n      player.tech_.off('usage', onHlsUsageEvent);\n    });\n\n    player.on('audiochange', (_, { index }) => {\n      this.select(index);\n      this.update(index);\n    });\n\n    // hide when new source set\n    player.on('loadstart', () => {\n      this.hide();\n    });\n  }\n\n  onChange({ value }) {\n    this.player_.audio().pick(value);\n  }\n\n  onAlternateAudio() {\n    const audioTracks = this.player_.audio().values();\n\n    const audioEntries = audioTracks.map((track, index) => {\n      const { id, kind, label, language } = track;\n\n      // label and value are necessary attributes\n      return {\n        label,\n        value: index,\n        id,\n        kind,\n        language,\n        index,\n        track\n      };\n    });\n\n    this.player_.trigger('before-audio-setup', audioEntries);\n\n    this.setEntries(audioEntries);\n\n    this.show();\n\n    this.player_.trigger('audio', audioEntries);\n  }\n\n  handleAudioChangeEvent() {\n    const audioTracks = this.player_.audio().values();\n    const currentEntry = audioTracks.reduce((acc, track, index) => {\n      if (track.enabled) {\n        acc = this.entries[index];\n      }\n\n      return acc;\n    }, {});\n\n    this.player_.trigger('audiochange', currentEntry);\n  }\n}\n\nvideojs.getComponent('SettingMenuButton').prototype.options_.entries.push('AudioTrackSettingItem');\n\nvideojs.registerComponent('AudioTrackSettingItem', AudioTrackSettingItem);\n\nexport default AudioTrackSettingItem;\n","import videojs from 'video.js';\nimport './AudioTrackSettingItem';\n\nclass audio extends videojs.getPlugin('plugin') {\n  constructor(player, options = {}) {\n    super(player, options);\n\n    this.track = this.values().find(track => track.enabled);\n\n    // I am worried about audio changed by other factor\n    // So also listen on `audiochange` and update the value\n    player.on('audiochange', (_, { index }) => {\n      this.track = this.values()[index];\n    });\n  }\n\n  values() {\n    const tracks = this.player.audioTracks();\n    const result = [];\n\n    for (let i = 0; i < tracks.length; i++) {\n      result.push(tracks[i]);\n    }\n\n    return result;\n  }\n\n  pick(index) {\n    const values = this.values();\n    const newAudio = values[index];\n\n    if (newAudio) {\n      this.track.enabled = false;\n      this.track = newAudio;\n\n      newAudio.enabled = true;\n    }\n  }\n}\n\nvideojs.registerPlugin('audio', audio);\n"],"names":["SettingOptionItem","videojs","getComponent","AudioTrackSettingItem","player","options","name","label","icon","addClass","timeout","onHlsUsageEvent","evt","clearTimeout","setTimeout","handleAudioChangeEvent","bind","onAlternateAudio","tech_","on","off","_","index","select","update","hide","onChange","value","player_","audio","pick","audioTracks","values","audioEntries","map","track","id","kind","language","trigger","setEntries","show","currentEntry","reduce","acc","enabled","entries","prototype","options_","push","registerComponent","find","tracks","result","i","length","newAudio","getPlugin","registerPlugin"],"mappings":"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"}