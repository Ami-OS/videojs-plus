{"version":3,"file":"quality.es.js","sources":["../../../source/Utils/List.js","../../../source/Plugin/Quality/QualitySettingItem.js","../../../source/Plugin/Quality/Quality.js"],"sourcesContent":["class List {\n  constructor(array, startIndex) {\n    this.values = array.slice(0);\n    this.index_ = startIndex || 0;\n    this.loop_ = true;\n  }\n\n  index(value) {\n    if (typeof value !== 'undefined') {\n      this.index_ = Math.max(0, Math.min(value, this.values.length - 1));\n    } else {\n      return this.index_;\n    }\n  }\n\n  loop(value) {\n    if (typeof value !== 'undefined') {\n      this.loop_ = !!value;\n    } else {\n      return this.loop_;\n    }\n  }\n\n  calc(steps) {\n    const newIndex = this.index_ + steps;\n    const length = this.values.length;\n\n    return this.loop_ ? (length + newIndex) % length : Math.max(0, Math.min(newIndex, length - 1));\n  }\n\n  step(steps) {\n    this.index_ = this.calc(steps);\n\n    return this.values[this.index_];\n  }\n\n  current() {\n    return this.values[this.index_];\n  }\n\n  next() {\n    return this.step(1);\n  }\n\n  prev() {\n    return this.step(-1);\n  }\n\n  ended() {\n    return this.index_ === this.values.length - 1;\n  }\n}\n\nexport default List;\n","import videojs from 'video.js';\n\nconst SettingOptionItem = videojs.getComponent('SettingOptionItem');\n\nclass QualitySettingItem extends SettingOptionItem {\n  constructor(player, options) {\n    super(player, {\n      ...options,\n      name: 'QualitySettingItem',\n      label: 'Quality',\n      icon: 'vjs-icon-hd',\n      entries: player.options_.quality || []\n    });\n\n    this.addClass('vjs-setting-quality');\n\n    player.on('quality', (_, qualities) => {\n      const entries = qualities.map((quality, index) => {\n        quality.value = index;\n        return quality;\n      });\n\n      this.setEntries(entries, player.qualities.index());\n\n      this.show();\n    });\n\n    player.on('qualitychange', (_, { index }) => {\n      this.select(index);\n      this.update(index);\n    });\n  }\n\n  onChange({ value }) {\n    this.player_.qualities.pick(value);\n  }\n}\n\nvideojs.getComponent('SettingMenuButton').prototype.options_.entries.push('QualitySettingItem');\n\nvideojs.registerComponent('QualitySettingItem', QualitySettingItem);\n\nexport default QualitySettingItem;\n","import videojs from 'video.js';\nimport List from '../../Utils/List';\n\nimport './QualitySettingItem';\n\nclass Quality extends List {\n  constructor(player, array, defaultQualityLevel = 0) {\n    super(array, defaultQualityLevel);\n\n    this.player_ = player;\n\n    this.pick(defaultQualityLevel, true);\n  }\n\n  pick(index, skip) {\n    if (typeof index !== 'undefined') {\n      this.index(index);\n    }\n\n    const player = this.player_;\n    const current = this.current();\n    const cachedCurrentTime = player.ended() ? 0 : player.currentTime();\n\n    if (!skip && cachedCurrentTime) {\n      player.one('loadedmetadata', () => {\n        player.one('canplaythrough', () => {\n          player.currentTime(cachedCurrentTime);\n        });\n\n        player.play();\n      });\n    }\n\n    player.src(current.sources);\n\n    player.trigger('qualitychange', {\n      ...current,\n      index: this.index()\n    });\n  }\n}\n\nconst setQualities = function(qualities, defaultQualityLevel) {\n  const player = this.player_;\n\n  player.qualities = new Quality(player, qualities, defaultQualityLevel);\n\n  player.trigger('quality', qualities);\n};\n\nvideojs.registerPlugin('setQualities', setQualities);\n\nvideojs.hook('setup', vjsPlayer => {\n  const { qualities } = vjsPlayer.options_;\n\n  if (qualities && qualities.length) {\n    const defaultQualityLevel = qualities.findIndex(v => v.default);\n\n    vjsPlayer.setQualities(qualities, defaultQualityLevel);\n  }\n});\n"],"names":["List","array","startIndex","values","slice","index_","loop_","index","value","Math","max","min","length","loop","calc","steps","newIndex","step","current","next","prev","ended","SettingOptionItem","videojs","getComponent","QualitySettingItem","player","options","name","label","icon","entries","options_","quality","addClass","on","_","qualities","map","setEntries","show","select","update","onChange","player_","pick","prototype","push","registerComponent","Quality","defaultQualityLevel","skip","cachedCurrentTime","currentTime","one","play","src","sources","trigger","setQualities","registerPlugin","hook","vjsPlayer","findIndex","v"],"mappings":"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"}