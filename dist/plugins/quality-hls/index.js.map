{"version":3,"file":"index.js","sources":["../../../source/Plugin/QualityHls/QualityHlsSettingItem.js"],"sourcesContent":["import videojs from 'video.js';\n\nconst SettingOptionItem = videojs.getComponent('SettingOptionItem');\n\nclass QualityHlsSettingItem extends SettingOptionItem {\n  constructor(player, options) {\n    super(player, {\n      ...options,\n      name: 'QualityHlsSettingItem',\n      label: 'Quality',\n      icon: 'vjs-icon-hd'\n    });\n\n    this.addClass('vjs-setting-quality');\n\n    this.levels = [];\n\n    this.handleAllLevelsAdded();\n  }\n\n  handleAllLevelsAdded() {\n    const player = this.player_;\n\n    if (!player.qualityLevels) {\n      videojs.log.warn('plugin videojs-contrib-quality-levels do not exsits');\n\n      return false;\n    }\n\n    const qualityLevels = player.qualityLevels();\n    let levels = [];\n    let timeout;\n\n    qualityLevels.on('addqualitylevel', ({ qualityLevel }) => {\n      clearTimeout(timeout);\n\n      levels.push(qualityLevel);\n\n      const callback = () => {\n        this.levels = levels.slice(0);\n\n        player.trigger('before-quality-setup', {\n          levels: this.levels\n        });\n\n        this.onAllLevelsAdded();\n\n        levels = [];\n      };\n\n      timeout = setTimeout(callback, 10);\n    });\n  }\n\n  onAllLevelsAdded() {\n    const entries = [\n      ...this.levels\n        .map(({ height }) => {\n          return {\n            label: this.localize(`${height}p`),\n            value: height,\n            default: false\n          };\n        })\n        .sort((a, b) => {\n          return b.value - a.value;\n        }),\n      {\n        label: 'Auto',\n        value: 'auto',\n        default: true\n      }\n    ];\n\n    this.setEntries(entries);\n\n    this.show();\n\n    this.player_.trigger('qualities', this.levels);\n  }\n\n  onChange(selected) {\n    const { value } = selected;\n\n    super.onChange(selected);\n\n    this.levels.forEach(lv => {\n      lv.enabled = lv.height === value || value === 'auto';\n    });\n\n    this.player_.trigger(\n      'qualitychange',\n      this.entries.reduce((acc, entry, index) => {\n        if (entry.value === value) {\n          const level = this.levels.find(v => v.height === value) || {};\n\n          acc = {\n            index,\n            ...entry,\n            ...level\n          };\n        }\n\n        return acc;\n      }, {})\n    );\n  }\n}\n\nvideojs.getComponent('SettingMenuButton').prototype.options_.entries.push('QualityHlsSettingItem');\n\nvideojs.registerComponent('QualityHlsSettingItem', QualityHlsSettingItem);\n\nexport default QualityHlsSettingItem;\n"],"names":["SettingOptionItem","videojs","getComponent","QualityHlsSettingItem","player","options","name","label","icon","addClass","levels","handleAllLevelsAdded","player_","qualityLevels","log","warn","timeout","on","qualityLevel","clearTimeout","push","callback","slice","trigger","onAllLevelsAdded","setTimeout","entries","map","height","localize","value","default","sort","a","b","setEntries","show","onChange","selected","forEach","lv","enabled","reduce","acc","entry","index","level","find","v","prototype","options_","registerComponent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAEA,IAAMA,iBAAiB,GAAGC,OAAO,CAACC,YAAR,CAAqB,mBAArB,CAA1B;;MAEMC;;;;;EACJ,iCAAYC,MAAZ,EAAoBC,OAApB,EAA6B;EAAA;;EAC3B,0CAAMD,MAAN,eACKC,OADL;EAEEC,MAAAA,IAAI,EAAE,uBAFR;EAGEC,MAAAA,KAAK,EAAE,SAHT;EAIEC,MAAAA,IAAI,EAAE;EAJR;;EAOA,UAAKC,QAAL,CAAc,qBAAd;;EAEA,UAAKC,MAAL,GAAc,EAAd;;EAEA,UAAKC,oBAAL;;EAZ2B;EAa5B;;;;WAEDA,uBAAA,gCAAuB;EAAA;;EACrB,QAAMP,MAAM,GAAG,KAAKQ,OAApB;;EAEA,QAAI,CAACR,MAAM,CAACS,aAAZ,EAA2B;EACzBZ,MAAAA,OAAO,CAACa,GAAR,CAAYC,IAAZ,CAAiB,qDAAjB;EAEA,aAAO,KAAP;EACD;;EAED,QAAMF,aAAa,GAAGT,MAAM,CAACS,aAAP,EAAtB;EACA,QAAIH,MAAM,GAAG,EAAb;EACA,QAAIM,OAAJ;EAEAH,IAAAA,aAAa,CAACI,EAAd,CAAiB,iBAAjB,EAAoC,gBAAsB;EAAA,UAAnBC,YAAmB,QAAnBA,YAAmB;EACxDC,MAAAA,YAAY,CAACH,OAAD,CAAZ;EAEAN,MAAAA,MAAM,CAACU,IAAP,CAAYF,YAAZ;;EAEA,UAAMG,QAAQ,GAAG,SAAXA,QAAW,GAAM;EACrB,QAAA,MAAI,CAACX,MAAL,GAAcA,MAAM,CAACY,KAAP,CAAa,CAAb,CAAd;EAEAlB,QAAAA,MAAM,CAACmB,OAAP,CAAe,sBAAf,EAAuC;EACrCb,UAAAA,MAAM,EAAE,MAAI,CAACA;EADwB,SAAvC;;EAIA,QAAA,MAAI,CAACc,gBAAL;;EAEAd,QAAAA,MAAM,GAAG,EAAT;EACD,OAVD;;EAYAM,MAAAA,OAAO,GAAGS,UAAU,CAACJ,QAAD,EAAW,EAAX,CAApB;EACD,KAlBD;EAmBD;;WAEDG,mBAAA,4BAAmB;EAAA;;EACjB,QAAME,OAAO,aACR,KAAKhB,MAAL,CACAiB,GADA,CACI,iBAAgB;EAAA,UAAbC,MAAa,SAAbA,MAAa;EACnB,aAAO;EACLrB,QAAAA,KAAK,EAAE,MAAI,CAACsB,QAAL,CAAiBD,MAAjB,OADF;EAELE,QAAAA,KAAK,EAAEF,MAFF;EAGLG,QAAAA,OAAO,EAAE;EAHJ,OAAP;EAKD,KAPA,EAQAC,IARA,CAQK,UAACC,CAAD,EAAIC,CAAJ,EAAU;EACd,aAAOA,CAAC,CAACJ,KAAF,GAAUG,CAAC,CAACH,KAAnB;EACD,KAVA,CADQ,GAYX;EACEvB,MAAAA,KAAK,EAAE,MADT;EAEEuB,MAAAA,KAAK,EAAE,MAFT;EAGEC,MAAAA,OAAO,EAAE;EAHX,KAZW,EAAb;EAmBA,SAAKI,UAAL,CAAgBT,OAAhB;EAEA,SAAKU,IAAL;EAEA,SAAKxB,OAAL,CAAaW,OAAb,CAAqB,WAArB,EAAkC,KAAKb,MAAvC;EACD;;WAED2B,WAAA,kBAASC,QAAT,EAAmB;EAAA;;EAAA,QACTR,KADS,GACCQ,QADD,CACTR,KADS;;EAGjB,iCAAMO,QAAN,YAAeC,QAAf;;EAEA,SAAK5B,MAAL,CAAY6B,OAAZ,CAAoB,UAAAC,EAAE,EAAI;EACxBA,MAAAA,EAAE,CAACC,OAAH,GAAaD,EAAE,CAACZ,MAAH,KAAcE,KAAd,IAAuBA,KAAK,KAAK,MAA9C;EACD,KAFD;EAIA,SAAKlB,OAAL,CAAaW,OAAb,CACE,eADF,EAEE,KAAKG,OAAL,CAAagB,MAAb,CAAoB,UAACC,GAAD,EAAMC,KAAN,EAAaC,KAAb,EAAuB;EACzC,UAAID,KAAK,CAACd,KAAN,KAAgBA,KAApB,EAA2B;EACzB,YAAMgB,KAAK,GAAG,MAAI,CAACpC,MAAL,CAAYqC,IAAZ,CAAiB,UAAAC,CAAC;EAAA,iBAAIA,CAAC,CAACpB,MAAF,KAAaE,KAAjB;EAAA,SAAlB,KAA6C,EAA3D;EAEAa,QAAAA,GAAG;EACDE,UAAAA,KAAK,EAALA;EADC,WAEED,KAFF,EAGEE,KAHF,CAAH;EAKD;;EAED,aAAOH,GAAP;EACD,KAZD,EAYG,EAZH,CAFF;EAgBD;;;IAtGiC3C;;EAyGpCC,OAAO,CAACC,YAAR,CAAqB,mBAArB,EAA0C+C,SAA1C,CAAoDC,QAApD,CAA6DxB,OAA7D,CAAqEN,IAArE,CAA0E,uBAA1E;EAEAnB,OAAO,CAACkD,iBAAR,CAA0B,uBAA1B,EAAmDhD,qBAAnD;;;;"}