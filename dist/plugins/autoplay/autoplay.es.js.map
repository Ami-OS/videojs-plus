{"version":3,"file":"autoplay.es.js","sources":["../../../source/Utils/Log.js","../../../source/Plugin/Autoplay/Autoplay.js"],"sourcesContent":["import videojs from 'video.js';\n\nlet logType = '';\n\ntry {\n  logType = localStorage && localStorage.getItem('vjs-plus-log');\n} catch (e) {}\n\nconst log = (function() {\n  if (logType === 'normal' || videojs.browser.IE_VERSION) {\n    // log without style\n    return console.info.bind(console, '[VJS Plus]:');\n  } else if (logType) {\n    // log with style\n    return console.info.bind(console, '%c[VJS Plus]:', 'font-weight: bold; color:#2196F3;');\n  }\n\n  return function() {};\n})();\n\nexport default log;\n","import videojs from 'video.js';\nimport log from '../../Utils/Log';\n\nconst AUTOPLAY_SUCCESS = 'autoplay-success';\nconst AUTOPLAY_FAILURE = 'autoplay-failure';\n\nconst AutoplayHandler = player => {\n  const NotPreoload = player.preload() === 'none';\n\n  if (!player.autoplay() || NotPreoload) {\n    player.mutedautoplay_ = 'ignore';\n\n    if (NotPreoload) {\n      videojs.log.warn('Preload is none so that manual autoplay start is disabled');\n      player.trigger(AUTOPLAY_FAILURE);\n    }\n\n    return false;\n  }\n\n  const pause = player.pause;\n\n  player.pause = () => {};\n\n  const callback = () => {\n    player.pause = pause;\n\n    player.mutedautoplay_ = true;\n  };\n\n  const resolved = () => {\n    log('Muted Autoplay - Promise Resolved');\n\n    player.trigger(AUTOPLAY_SUCCESS);\n\n    callback();\n  };\n\n  const rejected = error => {\n    log('Muted Autoplay - Promise Rejected', error);\n\n    player.muted(true);\n\n    const handlePlay = player.play();\n\n    if (handlePlay) {\n      handlePlay.then(resolved).catch(err => {\n        log('Seems autoplay is not allowed even player is muted', err);\n        player.trigger(AUTOPLAY_FAILURE);\n        player.hasStarted(false);\n        callback();\n      });\n    } else {\n      log('Second Play Promise is undefined');\n      callback();\n    }\n  };\n\n  player.one('loadedmetadata', function handleMutedAutoplay() {\n    // without ready, `player.play()` may retutn `undefined` as `this.changingSrc_` is true\n    player.ready(() => {\n      const playPromise = player.play();\n\n      if (playPromise !== undefined && playPromise !== null) {\n        playPromise.then(resolved).catch(rejected);\n      } else {\n        log('Browser not support play promise');\n\n        setTimeout(callback, 1000);\n      }\n    });\n  });\n};\n\nvideojs.hook('setup', vjsPlayer => {\n  vjsPlayer.one('loadstart', () => {\n    AutoplayHandler(vjsPlayer);\n  });\n});\n"],"names":["logType","localStorage","getItem","e","log","videojs","browser","IE_VERSION","console","info","bind","AUTOPLAY_SUCCESS","AUTOPLAY_FAILURE","AutoplayHandler","player","NotPreoload","preload","autoplay","mutedautoplay_","warn","trigger","pause","callback","resolved","rejected","error","muted","handlePlay","play","then","err","hasStarted","one","handleMutedAutoplay","ready","playPromise","undefined","setTimeout","hook","vjsPlayer"],"mappings":";;AAEA,IAAIA,OAAO,GAAG,EAAd;;AAEA,IAAI;EACFA,OAAO,GAAGC,YAAY,IAAIA,YAAY,CAACC,OAAb,CAAqB,cAArB,CAA1B;CADF,CAEE,OAAOC,CAAP,EAAU;;AAEZ,IAAMC,GAAG,GAAI,YAAW;MAClBJ,OAAO,KAAK,QAAZ,IAAwBK,OAAO,CAACC,OAAR,CAAgBC,UAA5C,EAAwD;;WAE/CC,OAAO,CAACC,IAAR,CAAaC,IAAb,CAAkBF,OAAlB,EAA2B,aAA3B,CAAP;GAFF,MAGO,IAAIR,OAAJ,EAAa;;WAEXQ,OAAO,CAACC,IAAR,CAAaC,IAAb,CAAkBF,OAAlB,EAA2B,eAA3B,EAA4C,mCAA5C,CAAP;;;SAGK,YAAW,EAAlB;CATU,EAAZ;;ACLA,IAAMG,gBAAgB,GAAG,kBAAzB;AACA,IAAMC,gBAAgB,GAAG,kBAAzB;;AAEA,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,CAAAC,MAAM,EAAI;MAC1BC,WAAW,GAAGD,MAAM,CAACE,OAAP,OAAqB,MAAzC;;MAEI,CAACF,MAAM,CAACG,QAAP,EAAD,IAAsBF,WAA1B,EAAuC;IACrCD,MAAM,CAACI,cAAP,GAAwB,QAAxB;;QAEIH,WAAJ,EAAiB;MACfV,OAAO,CAACD,GAAR,CAAYe,IAAZ,CAAiB,2DAAjB;MACAL,MAAM,CAACM,OAAP,CAAeR,gBAAf;;;WAGK,KAAP;;;MAGIS,KAAK,GAAGP,MAAM,CAACO,KAArB;;EAEAP,MAAM,CAACO,KAAP,GAAe,YAAM,EAArB;;MAEMC,QAAQ,GAAG,SAAXA,QAAW,GAAM;IACrBR,MAAM,CAACO,KAAP,GAAeA,KAAf;IAEAP,MAAM,CAACI,cAAP,GAAwB,IAAxB;GAHF;;MAMMK,QAAQ,GAAG,SAAXA,QAAW,GAAM;IACrBnB,GAAG,CAAC,mCAAD,CAAH;IAEAU,MAAM,CAACM,OAAP,CAAeT,gBAAf;IAEAW,QAAQ;GALV;;MAQME,QAAQ,GAAG,SAAXA,QAAW,CAAAC,KAAK,EAAI;IACxBrB,GAAG,CAAC,mCAAD,EAAsCqB,KAAtC,CAAH;IAEAX,MAAM,CAACY,KAAP,CAAa,IAAb;QAEMC,UAAU,GAAGb,MAAM,CAACc,IAAP,EAAnB;;QAEID,UAAJ,EAAgB;MACdA,UAAU,CAACE,IAAX,CAAgBN,QAAhB,WAAgC,UAAAO,GAAG,EAAI;QACrC1B,GAAG,CAAC,oDAAD,EAAuD0B,GAAvD,CAAH;QACAhB,MAAM,CAACM,OAAP,CAAeR,gBAAf;QACAE,MAAM,CAACiB,UAAP,CAAkB,KAAlB;QACAT,QAAQ;OAJV;KADF,MAOO;MACLlB,GAAG,CAAC,kCAAD,CAAH;MACAkB,QAAQ;;GAhBZ;;EAoBAR,MAAM,CAACkB,GAAP,CAAW,gBAAX,EAA6B,SAASC,mBAAT,GAA+B;;IAE1DnB,MAAM,CAACoB,KAAP,CAAa,YAAM;UACXC,WAAW,GAAGrB,MAAM,CAACc,IAAP,EAApB;;UAEIO,WAAW,KAAKC,SAAhB,IAA6BD,WAAW,KAAK,IAAjD,EAAuD;QACrDA,WAAW,CAACN,IAAZ,CAAiBN,QAAjB,WAAiCC,QAAjC;OADF,MAEO;QACLpB,GAAG,CAAC,kCAAD,CAAH;QAEAiC,UAAU,CAACf,QAAD,EAAW,IAAX,CAAV;;KARJ;GAFF;CApDF;;AAoEAjB,OAAO,CAACiC,IAAR,CAAa,OAAb,EAAsB,UAAAC,SAAS,EAAI;EACjCA,SAAS,CAACP,GAAV,CAAc,WAAd,EAA2B,YAAM;IAC/BnB,eAAe,CAAC0B,SAAD,CAAf;GADF;CADF"}