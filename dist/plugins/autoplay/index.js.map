{"version":3,"file":"index.js","sources":["../../../source/Utils/Log.js","../../../source/Plugin/Autoplay/Autoplay.js"],"sourcesContent":["import videojs from 'video.js';\n\nlet logType = '';\n\ntry {\n  logType = localStorage && localStorage.getItem('vjs-plus-log');\n} catch (e) {}\n\nconst log = (function() {\n  if (logType === 'normal' || videojs.browser.IE_VERSION) {\n    // log without style\n    return console.info.bind(console, '[VJS Plus]:');\n  } else if (logType) {\n    // log with style\n    return console.info.bind(console, '%c[VJS Plus]:', 'font-weight: bold; color:#2196F3;');\n  }\n\n  return function() {};\n})();\n\nexport default log;\n","import videojs from 'video.js';\nimport log from '../../Utils/Log';\n\nconst AUTOPLAY_SUCCESS = 'autoplay-success';\nconst AUTOPLAY_FAILURE = 'autoplay-failure';\n\nconst AutoplayHandler = player => {\n  const NotPreoload = player.preload() === 'none';\n\n  if (!player.autoplay() || NotPreoload) {\n    player.mutedautoplay_ = 'ignore';\n\n    if (NotPreoload) {\n      videojs.log.warn('Preload is none so that manual autoplay start is disabled');\n      player.trigger(AUTOPLAY_FAILURE);\n    }\n\n    return false;\n  }\n\n  const pause = player.pause;\n\n  player.pause = () => {};\n\n  const callback = () => {\n    player.pause = pause;\n\n    player.mutedautoplay_ = true;\n  };\n\n  const resolved = () => {\n    log('Muted Autoplay - Promise Resolved');\n\n    player.trigger(AUTOPLAY_SUCCESS);\n\n    callback();\n  };\n\n  const rejected = error => {\n    log('Muted Autoplay - Promise Rejected', error);\n\n    player.muted(true);\n\n    const handlePlay = player.play();\n\n    if (handlePlay) {\n      handlePlay.then(resolved).catch(err => {\n        log('Seems autoplay is not allowed even player is muted', err);\n        player.trigger(AUTOPLAY_FAILURE);\n        player.hasStarted(false);\n        callback();\n      });\n    } else {\n      log('Second Play Promise is undefined');\n      callback();\n    }\n  };\n\n  player.one('loadedmetadata', function handleMutedAutoplay() {\n    // without ready, `player.play()` may retutn `undefined` as `this.changingSrc_` is true\n    player.ready(() => {\n      const playPromise = player.play();\n\n      if (playPromise !== undefined && playPromise !== null) {\n        playPromise.then(resolved).catch(rejected);\n      } else {\n        log('Browser not support play promise');\n\n        setTimeout(callback, 1000);\n      }\n    });\n  });\n};\n\nvideojs.hook('setup', vjsPlayer => {\n  vjsPlayer.one('loadstart', () => {\n    AutoplayHandler(vjsPlayer);\n  });\n});\n"],"names":["logType","localStorage","getItem","e","log","videojs","browser","IE_VERSION","console","info","bind","AUTOPLAY_SUCCESS","AUTOPLAY_FAILURE","AutoplayHandler","player","NotPreoload","preload","autoplay","mutedautoplay_","warn","trigger","pause","callback","resolved","rejected","error","muted","handlePlay","play","then","err","hasStarted","one","handleMutedAutoplay","ready","playPromise","undefined","setTimeout","hook","vjsPlayer"],"mappings":"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"}